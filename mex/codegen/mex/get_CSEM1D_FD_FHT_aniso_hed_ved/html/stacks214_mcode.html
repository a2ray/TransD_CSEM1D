<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line"><span class="comment">%subfunctions</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line"><span class="comment">% to recursively calculate up/down stack reflectivities in the source layer</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line"><span class="comment">% this can be used for either mode (TE/TM)  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S125T19U2548">Rupperstack</span>,<span class="var type1" id="S126T19U2549">Rlowerstack</span>]=stacks(<span class="var type1" id="S127T34U2552">pz</span>,<span class="var type1" id="S128T1U2553">iTxLayer</span>,<span class="var type1" id="S129T34U2554">r</span>,<span class="var type1" id="S130T3U2555">z</span>,<span class="var type1" id="S131T1U2556">omega</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line">    <span class="comment">%global omega</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line"><span class="comment">% The last and first layer thicknesses are infinite</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line">    <span class="mxinfo" id="T20:U8"><span class="var type1" id="S132T20U2559">dz</span>          = <span class="mxinfo" id="T20:U10">diff(<span class="var type1" id="S130T3U2562">z</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line">    <span class="mxinfo" id="T1:U12"><span class="var type1" id="S134T1U2565">nz</span>          = <span class="mxinfo" id="T1:U14">length(<span class="var type1" id="S130T3U2568">z</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line">    <span class="mxinfo" id="T3:U16"><span class="var type1" id="S136T3U2571">d</span>           = <span class="mxinfo" id="T3:U18">zeros (<span class="mxinfo" id="T1:U19">1</span>,<span class="var type1" id="S134T1U2575">nz</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line">    <span class="mxinfo" id="T1:U21"><span class="mxinfo" id="T1:U22"><span class="var type1" id="S136T3U2579">d</span>(<span class="mxinfo" id="T1:U24">1</span>)</span>        = <span class="mxinfo" id="T1:U25">1d60</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line">    <span class="mxinfo" id="T3:U26"><span class="mxinfo" id="T3:U27"><span class="var type1" id="S136T3U2585">d</span>(<span class="mxinfo" id="T1:U29">2</span>:<span class="mxinfo" id="T1:U30"><span class="var type1" id="S134T1U2589">nz</span>-<span class="mxinfo" id="T1:U32">1</span></span>)</span>   = <span class="mxinfo" id="T3:U33"><span class="var type1" id="S132T20U2592">dz</span>(<span class="mxinfo" id="T1:U35">2</span>:<span class="mxinfo" id="T1:U36">end</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line">    <span class="mxinfo" id="T1:U37"><span class="mxinfo" id="T1:U38"><span class="var type1" id="S136T3U2600">d</span>(<span class="var type1" id="S134T1U2601">nz</span>)</span>       = <span class="mxinfo" id="T1:U41">1d60</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line"><span class="comment">% Capital R is for a stack   </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line"><span class="comment">% Starting from the bottom up, for Rs_down    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line">    <span class="mxinfo" id="T19:U42"><span class="var type1" id="S126T19U2605">Rlowerstack</span>=<span class="mxinfo" id="T19:U44"><span class="mxinfo" id="T1:U45">0</span>*<span class="mxinfo" id="T19:U46">1i</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S139T1U2611">k</span>   = (<span class="mxinfo" id="T1:U48"><span class="var type1" id="S134T1U2616">nz</span>-<span class="mxinfo" id="T1:U50">1</span></span>):<span class="mxinfo" id="T1:U51">-1</span>:<span class="var type1" id="S128T1U2620">iTxLayer</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line">        <span class="mxinfo" id="T19:U53"><span class="var type1" id="S140T19U2623">Rs_d</span> = <span class="mxinfo" id="T19:U55">(<span class="mxinfo" id="T19:U56"><span class="mxinfo" id="T19:U57"><span class="var type1" id="S129T34U2628">r</span>(<span class="var type1" id="S139T1U2629">k</span>)</span> + <span class="mxinfo" id="T19:U60"><span class="var type1" id="S126T19U2631">Rlowerstack</span>*<span class="mxinfo" id="T19:U62">exp(<span class="mxinfo" id="T19:U63"><span class="mxinfo" id="T19:U64"><span class="mxinfo" id="T19:U65"><span class="mxinfo" id="T19:U66">2i</span>*<span class="var type1" id="S131T1U2638">omega</span></span>*<span class="mxinfo" id="T19:U68"><span class="var type1" id="S127T34U2640">pz</span>(<span class="mxinfo" id="T1:U70"><span class="var type1" id="S139T1U2642">k</span>+<span class="mxinfo" id="T1:U72">1</span></span>)</span></span>*<span class="mxinfo" id="T1:U73"><span class="var type1" id="S136T3U2645">d</span>(<span class="mxinfo" id="T1:U75"><span class="var type1" id="S139T1U2647">k</span>+<span class="mxinfo" id="T1:U77">1</span></span>)</span></span>)</span></span></span>)/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line"><span class="mxinfo" id="T19:U53"><span class="mxinfo" id="T19:U55">              (<span class="mxinfo" id="T19:U78"><span class="mxinfo" id="T1:U79">1</span> + <span class="mxinfo" id="T19:U80"><span class="mxinfo" id="T19:U81"><span class="mxinfo" id="T19:U82"><span class="var type1" id="S129T34U2655">r</span>(<span class="var type1" id="S139T1U2656">k</span>)</span>*<span class="var type1" id="S126T19U2657">Rlowerstack</span></span>*<span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line"><span class="mxinfo" id="T19:U53"><span class="mxinfo" id="T19:U55"><span class="mxinfo" id="T19:U78"><span class="mxinfo" id="T19:U80">              <span class="mxinfo" id="T19:U86">exp(<span class="mxinfo" id="T19:U87"><span class="mxinfo" id="T19:U88"><span class="mxinfo" id="T19:U89"><span class="mxinfo" id="T19:U90">2i</span>*<span class="var type1" id="S131T1U2664">omega</span></span>*<span class="mxinfo" id="T19:U92"><span class="var type1" id="S127T34U2666">pz</span>(<span class="mxinfo" id="T1:U94"><span class="var type1" id="S139T1U2668">k</span>+<span class="mxinfo" id="T1:U96">1</span></span>)</span></span>*<span class="mxinfo" id="T1:U97"><span class="var type1" id="S136T3U2671">d</span>(<span class="mxinfo" id="T1:U99"><span class="var type1" id="S139T1U2673">k</span>+<span class="mxinfo" id="T1:U101">1</span></span>)</span></span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line">        <span class="mxinfo" id="T19:U102"><span class="var type1" id="S126T19U2677">Rlowerstack</span>=<span class="var type1" id="S140T19U2678">Rs_d</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line">    <span class="mxinfo" id="T19:U105"><span class="var type1" id="S125T19U2681">Rupperstack</span>=<span class="mxinfo" id="T19:U107"><span class="mxinfo" id="T1:U108">0</span>*<span class="mxinfo" id="T19:U109">1i</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line"><span class="comment">% Starting from the top down for Rs_up</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S139T1U2687">k</span>   = <span class="mxinfo" id="T1:U111">2</span>:<span class="var type1" id="S128T1U2690">iTxLayer</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line">        <span class="mxinfo" id="T19:U113"><span class="var type1" id="S142T19U2693">Rs_u</span> = <span class="mxinfo" id="T19:U115">(<span class="mxinfo" id="T19:U116"><span class="mxinfo" id="T19:U117">-<span class="mxinfo" id="T19:U118"><span class="var type1" id="S129T34U2699">r</span>(<span class="mxinfo" id="T1:U120"><span class="var type1" id="S139T1U2701">k</span>-<span class="mxinfo" id="T1:U122">1</span></span>)</span></span> + <span class="mxinfo" id="T19:U123"><span class="var type1" id="S125T19U2704">Rupperstack</span>*<span class="mxinfo" id="T19:U125">exp(<span class="mxinfo" id="T19:U126"><span class="mxinfo" id="T19:U127"><span class="mxinfo" id="T19:U128"><span class="mxinfo" id="T19:U129">2i</span>*<span class="var type1" id="S131T1U2711">omega</span></span>*<span class="mxinfo" id="T19:U131"><span class="var type1" id="S127T34U2713">pz</span>(<span class="mxinfo" id="T1:U133"><span class="var type1" id="S139T1U2715">k</span>-<span class="mxinfo" id="T1:U135">1</span></span>)</span></span>*<span class="mxinfo" id="T1:U136"><span class="var type1" id="S136T3U2718">d</span>(<span class="mxinfo" id="T1:U138"><span class="var type1" id="S139T1U2720">k</span>-<span class="mxinfo" id="T1:U140">1</span></span>)</span></span>)</span></span></span>)/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line"><span class="mxinfo" id="T19:U113"><span class="mxinfo" id="T19:U115">              (<span class="mxinfo" id="T19:U141"><span class="mxinfo" id="T1:U142">1</span> - <span class="mxinfo" id="T19:U143"><span class="mxinfo" id="T19:U144"><span class="mxinfo" id="T19:U145"><span class="var type1" id="S129T34U2728">r</span>(<span class="mxinfo" id="T1:U147"><span class="var type1" id="S139T1U2730">k</span>-<span class="mxinfo" id="T1:U149">1</span></span>)</span>*<span class="var type1" id="S125T19U2732">Rupperstack</span></span>*<span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line"><span class="mxinfo" id="T19:U113"><span class="mxinfo" id="T19:U115"><span class="mxinfo" id="T19:U141"><span class="mxinfo" id="T19:U143">              <span class="mxinfo" id="T19:U151">exp(<span class="mxinfo" id="T19:U152"><span class="mxinfo" id="T19:U153"><span class="mxinfo" id="T19:U154"><span class="mxinfo" id="T19:U155">2i</span>*<span class="var type1" id="S131T1U2739">omega</span></span>*<span class="mxinfo" id="T19:U157"><span class="var type1" id="S127T34U2741">pz</span>(<span class="mxinfo" id="T1:U159"><span class="var type1" id="S139T1U2743">k</span>-<span class="mxinfo" id="T1:U161">1</span></span>)</span></span>*<span class="mxinfo" id="T1:U162"><span class="var type1" id="S136T3U2746">d</span>(<span class="mxinfo" id="T1:U164"><span class="var type1" id="S139T1U2748">k</span>-<span class="mxinfo" id="T1:U166">1</span></span>)</span></span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">        <span class="mxinfo" id="T19:U167"><span class="var type1" id="S125T19U2752">Rupperstack</span>=<span class="var type1" id="S142T19U2753">Rs_u</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line"></span></span>
</pre>
